<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script>{% extends "base.html" %}
{% block content %}
    <header class="bg-header text-white p-6">
        <div class="container flex items-center">
            <img src="/static/images/edgi-logo.png" alt="EDGI Logo" class="h-12 mr-4">
            <h1 class="text-3xl font-bold">Admin - {{ content.title.content | default("EDGI Cloud Project") }}</h1>
        </div>
    </header>
    <main class="container py-6">
        {% include "partials/_messages.html" %}
        <section class="mb-8">
            <h2 class="text-2xl font-semibold mb-4">Site Title</h2>
            <div class="card p-4 mb-4">
                <p class="mb-2">{{ content.title.content | default("EDGI Cloud Project") }}</p>
                <button onclick="document.getElementById('title-form').classList.toggle('hidden')" class="btn btn-primary">Edit Title</button>
                <form id="title-form" method="POST" class="space-y-4 mt-4 hidden">
                    <input type="hidden" name="user_id" value="{{ user_id }}">
                    <input type="hidden" name="action" value="update_title">
                    <div>
                        <label for="title" class="form-label">Title:</label>
                        <input type="text" name="title" id="title" class="form-input" value="{{ content.title.content | default('') }}">
                    </div>
                    <div class="flex space-x-4">
                        <button type="submit" class="btn btn-primary">Update Title</button>
                        <button type="button" onclick="document.getElementById('title-form').classList.add('hidden')" class="btn btn-secondary">Cancel</button>
                    </div>
                </form>
            </div>
        </section>
        <section class="mb-8">
            <h2 class="text-2xl font-semibold mb-4">Header Image</h2>
            <div class="card p-4 mb-4">
                {% if content.header_image.image_url %}
                    <p class="mb-2">Current Header Image: {{ content.header_image.image_url }}</p>
                    {% if content.header_image.credit_url %}
                        <p class="text-sm text-textlight">Image credit: <a href="{{ content.header_image.credit_url }}" class="text-accent hover:underline">{{ content.header_image.credit_text }}</a></p>
                    {% elif content.header_image.credit_text %}
                        <p class="text-sm text-textlight">Image credit: {{ content.header_image.credit_text }}</p>
                    {% endif %}
                {% endif %}
                <button onclick="document.getElementById('header-image-form').classList.toggle('hidden')" class="btn btn-primary">Edit Header Image</button>
                <form id="header-image-form" method="POST" enctype="multipart/form-data" class="space-y-4 mt-4 hidden">
                    <input type="hidden" name="user_id" value="{{ user_id }}">
                    <input type="hidden" name="action" value="update_header_image">
                    <div>
                        <label for="header_image" class="form-label">Image File (.jpg or .png, max 5MB):</label>
                        <input type="file" name="header_image" id="header_image" class="form-input" accept=".jpg,.png">
                    </div>
                    <div>
                        <label for="alt_text" class="form-label">Alt Text:</label>
                        <input type="text" name="alt_text" id="alt_text" class="form-input" value="{{ content.header_image.alt_text | default('') }}">
                    </div>
                    <div>
                        <label for="credit_url" class="form-label">Credit URL:</label>
                        <input type="url" name="credit_url" id="credit_url" class="form-input" value="{{ content.header_image.credit_url | default('') }}">
                    </div>
                    <div>
                        <label for="credit_text" class="form-label">Credit Text:</label>
                        <input type="text" name="credit_text" id="credit_text" class="form-input" value="{{ content.header_image.credit_text | default('') }}">
                    </div>
                    <div class="flex space-x-4">
                        <button type="submit" class="btn btn-primary">Update Header Image</button>
                        <button type="button" onclick="document.getElementById('header-image-form').classList.add('hidden')" class="btn btn-secondary">Cancel</button>
                    </div>
                </form>
            </div>
        </section>
        <section class="mb-8">
            <h2 class="text-2xl font-semibold mb-4">About {{ content.title.content | default("EDGI Cloud Project") }}</h2>
            <div class="card p-4 mb-4">
                {% for paragraph in content.info.paragraphs | default(["The EDGI Cloud Project enables sharing of environmental datasets for research and policy."]) %}
                    <p class="mb-2">{{ paragraph | safe }}</p>
                {% endfor %}
                <button onclick="document.getElementById('info-form').classList.toggle('hidden')" class="btn btn-primary">Edit Info</button>
                <form id="info-form" method="POST" class="space-y-4 mt-4 hidden">
                    <input type="hidden" name="user_id" value="{{ user_id }}">
                    <input type="hidden" name="action" value="update_info">
                    <div>
                        <label for="info_content" class="form-label">Content (press Enter for new paragraphs, use [text](url) for links):</label>
                        <textarea name="info_content" id="info_content" class="form-input">{{ content.info.content | default('') }}</textarea>
                    </div>
                    <div class="flex space-x-4">
                        <button type="submit" class="btn btn-primary">Update Info</button>
                        <button type="button" onclick="document.getElementById('info-form').classList.add('hidden')" class="btn btn-secondary">Cancel</button>
                    </div>
                </form>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                    {% for card in feature_cards %}
                        <div class="card p-4">
                            <h3 class="text-xl font-semibold mb-2">{{ card.title }}</h3>
                            <p>{{ card.description }}</p>
                            {% if card.url %}
                                <a href="{{ card.url }}" class="text-accent hover:underline">Learn More</a>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
                <button onclick="document.getElementById('feature-cards-form').classList.toggle('hidden')" class="btn btn-primary">Edit Feature Cards</button>
                <form id="feature-cards-form" method="POST" class="space-y-4 mt-4 hidden">
                    <input type="hidden" name="user_id" value="{{ user_id }}">
                    <input type="hidden" name="action" value="update_feature_cards">
                    {% for card in feature_cards %}
                        <div class="border p-4">
                            <h4 class="font-semibold">Card {{ loop.index }}:</h4>
                            <div class="mb-2">
                                <label for="card_title_{{ loop.index }}" class="form-label">Title:</label>
                                <input type="text" name="card_title_{{ loop.index }}" id="card_title_{{ loop.index }}" class="form-input" value="{{ card.title }}">
                            </div>
                            <div class="mb-2">
                                <label for="card_description_{{ loop.index }}" class="form-label">Description:</label>
                                <textarea name="card_description_{{ loop.index }}" id="card_description_{{ loop.index }}" class="form-input">{{ card.description }}</textarea>
                            </div>
                            <div class="mb-2">
                                <label for="card_url_{{ loop.index }}" class="form-label">URL:</label>
                                <input type="url" name="card_url_{{ loop.index }}" id="card_url_{{ loop.index }}" class="form-input" value="{{ card.url }}">
                            </div>
                        </div>
                    {% endfor %}
                    <div class="flex space-x-4">
                        <button type="submit" class="btn btn-primary">Update Feature Cards</button>
                        <button type="button" onclick="document.getElementById('feature-cards-form').classList.add('hidden')" class="btn btn-secondary">Cancel</button>
                    </div>
                </form>
            </div>
        </section>
        <section class="mb-8">
            <h2 class="text-2xl font-semibold mb-4">Statistics</h2>
            <div class="card p-4 mb-4">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    {% for stat in statistics %}
                        <div class="card p-4 text-center">
                            <p class="text-3xl font-bold">{{ stat.value }}</p>
                            <p class="text-textlight">{{ stat.label }}</p>
                            {% if stat.url %}
                                <a href="{{ stat.url }}" class="text-accent hover:underline">View</a>
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
                <button onclick="document.getElementById('statistics-form').classList.toggle('hidden')" class="btn btn-primary">Edit Statistics</button>
                <form id="statistics-form" method="POST" class="space-y-4 mt-4 hidden">
                    <input type="hidden" name="user_id" value="{{ user_id }}">
                    <input type="hidden" name="action" value="update_statistics">
                    {% for stat in statistics %}
                        <div class="border p-4">
                            <h4 class="font-semibold">Statistic {{ loop.index }}:</h4>
                            <div class="mb-2">
                                <label for="stat_label_{{ loop.index }}" class="form-label">Label:</label>
                                <input type="text" name="stat_label_{{ loop.index }}" id="stat_label_{{ loop.index }}" class="form-input" value="{{ stat.label }}">
                            </div>
                            <div class="mb-2">
                                <label for="stat_value_{{ loop.index }}" class="form-label">Value:</label>
                                <input type="text" name="stat_value_{{ loop.index }}" id="stat_value_{{ loop.index }}" class="form-input" value="{{ stat.value }}">
                            </div>
                            <div class="mb-2">
                                <label for="stat_url_{{ loop.index }}" class="form-label">URL:</label>
                                <input type="url" name="stat_url_{{ loop.index }}" id="stat_url_{{ loop.index }}" class="form-input" value="{{ stat.url }}">
                            </div>
                        </div>
                    {% endfor %}
                    <div class="flex space-x-4">
                        <button type="submit" class="btn btn-primary">Update Statistics</button>
                        <button type="button" onclick="document.getElementById('statistics-form').classList.add('hidden')" class="btn btn-secondary">Cancel</button>
                    </div>
                </form>
            </div>
        </section>
        <section class="mb-8">
            <h2 class="text-2xl font-semibold mb-4">Footer</h2>
            <div class="card p-4 mb-4">
                {% for paragraph in footer.paragraphs %}
                    <p class="mb-2">{{ paragraph | safe }}</p>
                {% endfor %}
                <p>{{ footer.odbl_text }}</p>
                <button onclick="document.getElementById('footer-form').classList.toggle('hidden')" class="btn btn-primary">Edit Footer</button>
                <form id="footer-form" method="POST" class="space-y-4 mt-4 hidden">
                    <input type="hidden" name="user_id" value="{{ user_id }}">
                    <input type="hidden" name="action" value="update_footer">
                    <div>
                        <label for="footer_content" class="form-label">Content (press Enter for new paragraphs, use [text](url) for links):</label>
                        <textarea name="footer_content" id="footer_content" class="form-input">{{ content.footer.content | default('') }}</textarea>
                    </div>
                    <div>
                        <label for="odbl_text" class="form-label">License Link Text:</label>
                        <input type="text" name="odbl_text" id="odbl_text" class="form-input" value="{{ footer.odbl_text | default('') }}">
                    </div>
                    <div class="flex space-x-4">
                        <button type="submit" class="btn btn-primary">Update Footer</button>
                        <button type="button" onclick="document.getElementById('footer-form').classList.add('hidden')" class="btn btn-secondary">Cancel</button>
                    </div>
                </form>
            </div>
        </section>
    </main>
{% endblock %}