
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.9">
    <title>System Administration - {{ content.title.content | default("EDGI Datasette Cloud Portal") }}</title>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <script src="/static/js/tailwind.config.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
    <link rel="stylesheet" href="/static/styles.css">
    <link rel="icon" href="/static/favicon.ico">
</head>
<body class="bg-background">
    <header class="fixed top-0 left-0 right-0 z-50 bg-header text-white shadow-md">
        <div class="container mx-auto px-4 h-20 flex items-center justify-between">
            <div class="flex items-center">
                <div class="w-10 h-10 flex items-center justify-center mr-3">
                    <i class="ri-admin-line text-white ri-2x" aria-hidden="true"></i>
                </div>
                <div class="text-xl font-semibold">System Administration</div>
            </div>
            {% if actor %}
                <div>
                    <a href="/manage-databases" class="text-white hover:text-accent mr-4">My Databases</a>
                    <a href="/system-trash" class="text-white hover:text-accent mr-4">System Trash</a>
                    <a href="/profile" class="text-white hover:text-accent mr-4">Profile</a>
                    <a href="/logout" class="text-white hover:text-accent">Logout</a>
                </div>
            {% endif %}
        </div>
    </header>
    
    <main class="flex-grow pt-20 pb-6">
        <section class="container mx-auto px-4 mt-6">
            <!-- Header -->
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h1 class="text-3xl font-bold text-primary">System Administration</h1>
                    <p class="text-textlight mt-2">Manage users, databases, and system activity</p>
                </div>
                <div class="flex gap-3">
                    <a href="/edit-portal-homepage" class="bg-blue-500 text-white px-6 py-3 rounded-button hover:bg-blue-600 transition font-medium">
                        <i class="ri-palette-line mr-2"></i>Edit Portal Homepage
                    </a>
                    <a href="/register" class="bg-accent text-white px-6 py-3 rounded-button hover:bg-primary transition font-medium">
                        <i class="ri-user-add-line mr-2"></i>Add New User
                    </a>
                </div>
            </div>

            <!-- Success/Error Messages -->
            {% if success %}
                <div class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-6">
                    <p class="text-sm">{{ success }}</p>
                </div>
            {% endif %}
            {% if error %}
                <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6">
                    <p class="text-sm">{{ error }}</p>
                </div>
            {% endif %}

            <!-- Statistics Cards -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-blue-500 rounded-card p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-3xl font-bold">{{ users|length }}</h3>
                            <p class="text-blue-100">Total Users</p>
                        </div>
                        <i class="ri-user-line text-4xl text-blue-200"></i>
                    </div>
                </div>
                <div class="bg-green-500 rounded-card p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-3xl font-bold">{{ databases|length }}</h3>
                            <p class="text-green-100">Active Databases</p>
                        </div>
                        <i class="ri-database-line text-4xl text-green-200"></i>
                    </div>
                </div>
                <div class="bg-purple-500 rounded-card p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-3xl font-bold">{{ databases|selectattr('status', 'equalto', 'Published')|list|length }}</h3>
                            <p class="text-purple-100">Published</p>
                        </div>
                        <i class="ri-global-line text-4xl text-purple-200"></i>
                    </div>
                </div>
                <div class="bg-orange-500 rounded-card p-6 text-white">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-3xl font-bold">{{ activity_logs|length }}</h3>
                            <p class="text-orange-100">Recent Activities</p>
                        </div>
                        <i class="ri-activity-line text-4xl text-orange-200"></i>
                    </div>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="bg-card rounded-card border border-border">
                <div class="border-b border-border">
                    <nav class="flex">
                        <button onclick="showTab('databases')" id="databases-tab" class="tab-button active px-6 py-4 font-medium text-accent border-b-2 border-accent">
                            <i class="ri-database-line mr-2"></i>Databases
                        </button>
                        <button onclick="showTab('users')" id="users-tab" class="tab-button px-6 py-4 font-medium text-textlight hover:text-accent">
                            <i class="ri-user-line mr-2"></i>Users
                        </button>
                        <button onclick="showTab('activity')" id="activity-tab" class="tab-button px-6 py-4 font-medium text-textlight hover:text-accent">
                            <i class="ri-activity-line mr-2"></i>Activity Logs
                        </button>
                    </nav>
                </div>

                <!-- Databases Tab (Now First and Default) -->
                <div id="databases-content" class="tab-content p-6">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-primary">Database Overview</h3>
                        <div class="flex gap-2">
                            <select id="status-filter" onchange="filterDatabases()" class="px-3 py-2 border rounded text-sm">
                                <option value="">All Statuses</option>
                                <option value="Published">Published</option>
                                <option value="Draft">Draft</option>
                                <option value="Unpublished">Unpublished</option>
                                <option value="Trashed">Trashed</option>
                            </select>
                            <a href="/system-trash" class="bg-red-500 text-white px-3 py-2 rounded text-sm hover:bg-red-600 transition">
                                <i class="ri-delete-bin-line mr-1"></i>View System Trash
                            </a>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="text-left p-3 font-medium text-white bg-header">Database Name</th>
                                    <th class="text-left p-3 font-medium text-white bg-header">Owner</th>
                                    <th class="text-left p-3 font-medium text-white bg-header">Status</th>
                                    <th class="text-left p-3 font-medium text-white bg-header">Created</th>
                                    <th class="text-left p-3 font-medium text-white bg-header">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="databases-table-body">
                                {% for db in databases %}
                                    <tr class="border-b hover:bg-gray-50 transition database-row" data-status="{{ db.status }}">
                                        <td class="p-3">
                                            <div class="flex items-center">
                                                <div class="w-8 h-8 bg-green-500 rounded-full flex items-center justify-center mr-3">
                                                    <i class="ri-database-line text-white text-sm"></i>
                                                </div>
                                                <span class="font-medium">{{ db.db_name.replace('_', ' ').title() }}</span>
                                            </div>
                                        </td>
                                        <td class="p-3 text-textlight">{{ db.username }}</td>
                                        <td class="p-3">
                                            <span class="px-2 py-1 rounded-full text-xs font-medium 
                                                {% if db.status == 'Published' %}bg-green-100 text-green-800
                                                {% elif db.status == 'Unpublished' %}bg-blue-100 text-blue-800
                                                {% elif db.status == 'Trashed' %}bg-red-100 text-red-800
                                                {% else %}bg-yellow-100 text-yellow-800{% endif %}">
                                                {{ db.status }}
                                            </span>
                                        </td>
                                        <td class="p-3 text-textlight">{{ db.created_at[:10] if db.created_at else 'N/A' }}</td>
                                        <td class="p-3">
                                            <div class="flex gap-2">
                                                <!-- View Homepage Button (for Published databases) -->
                                                {% if db.status == 'Published' %}
                                                    <a href="/db/{{ db.db_name }}/homepage" target="_blank" 
                                                       class="text-purple-500 hover:text-purple-700 text-sm px-2 py-1 rounded transition">
                                                        <i class="ri-home-line mr-1"></i>View Homepage
                                                    </a>
                                                {% endif %}
                                                
                                                <!-- View Database Button -->
                                                {% if db.status == 'Published' %}
                                                    <a href="{{ db.website_url }}" target="_blank" 
                                                       class="text-green-500 hover:text-green-700 text-sm px-2 py-1 rounded transition">
                                                        <i class="ri-external-link-line mr-1"></i>View Database
                                                    </a>
                                                {% endif %}
                                                
                                                <!-- View Details Button -->
                                                <button onclick="toggleDatabaseDetails('{{ db.db_id }}')" 
                                                        class="text-blue-500 hover:text-blue-700 text-sm px-2 py-1 rounded transition">
                                                    <i class="ri-eye-line mr-1"></i>View Details
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    <!-- Expandable Details Section -->
                                    <tr id="details-{{ db.db_id }}" class="hidden database-details bg-gray-50">
                                        <td colspan="5" class="p-4">
                                            <div class="bg-white rounded border border-gray-200 p-4">
                                                <h4 class="font-semibold text-gray-800 mb-3">Database Details</h4>
                                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
                                                    <div>
                                                        <div class="space-y-2">
                                                            <div><strong>Database ID:</strong> {{ db.db_id }}</div>
                                                            <div><strong>Name:</strong> {{ db.db_name }}</div>
                                                            <div><strong>Owner:</strong> {{ db.username }}</div>
                                                            <div><strong>Status:</strong> {{ db.status }}</div>
                                                            <div><strong>Created:</strong> {{ db.created_at[:19] if db.created_at else 'N/A' }}</div>
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <div class="space-y-2">
                                                            <div><strong>Website URL:</strong> 
                                                                {% if db.website_url %}
                                                                    <a href="{{ db.website_url }}" target="_blank" class="text-blue-500 hover:text-blue-700">{{ db.website_url }}</a>
                                                                {% else %}
                                                                    Not available
                                                                {% endif %}
                                                            </div>
                                                            <div><strong>File Path:</strong> <span class="font-mono text-xs">{{ db.db_name }}.db</span></div>
                                                            <div id="stats-{{ db.db_id }}" class="text-gray-600">
                                                                <i class="ri-loader-line animate-spin mr-1"></i>Loading database statistics...
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Users Tab -->
                <div id="users-content" class="tab-content p-6 hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-primary">User Management</h3>
                        <div class="flex gap-3">
                            <!-- User Search -->
                            <div class="relative">
                                <input type="text" id="user-search" placeholder="Search users..." 
                                       class="pl-10 pr-4 py-2 border rounded-button focus:outline-none focus:ring-2 focus:ring-accent text-sm"
                                       onkeyup="filterUsers()">
                                <i class="ri-search-line absolute left-3 top-2.5 text-gray-400"></i>
                            </div>
                            <!-- Role Filter -->
                            <select id="role-filter" onchange="filterUsers()" class="px-3 py-2 border rounded-button text-sm focus:outline-none focus:ring-2 focus:ring-accent">
                                <option value="">All Roles</option>
                                <option value="system_user">System User</option>
                                <option value="system_admin">System Admin</option>
                            </select>
                            <a href="/register" class="bg-accent text-white px-4 py-2 rounded-button hover:bg-primary transition text-sm">
                                <i class="ri-user-add-line mr-1"></i>Add User
                            </a>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="bg-gray-50">
                                    <th class="text-left p-3 font-medium text-white bg-header">Username</th>
                                    <th class="text-left p-3 font-medium text-white bg-header">Email</th>
                                    <th class="text-left p-3 font-medium text-white bg-header">Role</th>
                                    <th class="text-left p-3 font-medium text-white bg-header">Created</th>
                                    <th class="text-left p-3 font-medium text-white bg-header">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body">
                                {% for user in users %}
                                    <tr class="border-b hover:bg-gray-50 transition user-row" 
                                        data-username="{{ user.username.lower() }}" 
                                        data-email="{{ user.email.lower() }}" 
                                        data-role="{{ user.role }}">
                                        <td class="p-3">
                                            <div class="flex items-center">
                                                <div class="w-8 h-8 bg-accent rounded-full flex items-center justify-center mr-3">
                                                    <i class="ri-user-line text-white text-sm"></i>
                                                </div>
                                                <span class="font-medium">{{ user.username }}</span>
                                            </div>
                                        </td>
                                        <td class="p-3 text-textlight">{{ user.email }}</td>
                                        <td class="p-3">
                                            <span class="px-2 py-1 rounded-full text-xs font-medium 
                                                {% if user.role == 'system_admin' %}bg-red-100 text-red-800{% else %}bg-blue-100 text-blue-800{% endif %}">
                                                {{ user.role.replace('_', ' ').title() }}
                                            </span>
                                        </td>
                                        <td class="p-3 text-textlight">{{ user.created_at[:10] if user.created_at else 'N/A' }}</td>
                                        <td class="p-3">
                                            <div class="flex gap-2">
                                                <!-- Edit User Role Button -->
                                                <button onclick="editUserRole('{{ user.user_id }}', '{{ user.username }}', '{{ user.role }}')" 
                                                        class="text-accent hover:text-primary text-sm px-2 py-1 rounded transition">
                                                    <i class="ri-edit-line mr-1"></i>Edit Role
                                                </button>
                                                
                                                <!-- Delete User Button (only if not current user) -->
                                                {% if user.username != actor.username %}
                                                    <button onclick="deleteUser('{{ user.user_id }}', '{{ user.username }}')" 
                                                            class="text-red-500 hover:text-red-700 text-sm px-2 py-1 rounded transition">
                                                        <i class="ri-delete-bin-line mr-1"></i>Delete
                                                    </button>
                                                {% else %}
                                                    <span class="text-gray-400 text-sm px-2 py-1">Current User</span>
                                                {% endif %}
                                            </div>
                                        </td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Activity Logs Tab -->
                <div id="activity-content" class="tab-content p-6 hidden">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-semibold text-primary">Recent Activity</h3>
                        <select id="activity-filter" onchange="filterActivity()" class="px-3 py-2 border rounded text-sm">
                            <option value="">All Actions</option>
                            <option value="login">Login</option>
                            <option value="register">Register</option>
                            <option value="create_database">Create Database</option>
                            <option value="publish_database">Publish Database</option>
                            <option value="csv_upload">Upload CSV</option>
                            <option value="edit_portal_homepage">Edit Portal</option>
                            <option value="trash_database">Trash Database</option>
                            <option value="restore_database">Restore Database</option>
                        </select>
                    </div>
                    
                    <div class="space-y-4 max-h-96 overflow-y-auto" id="activity-logs-container">
                        {% for log in activity_logs %}
                            <div class="flex items-start p-4 bg-gray-50 rounded activity-log" data-action="{{ log.action }}">
                                <div class="w-10 h-10 rounded-full flex items-center justify-center mr-4
                                    {% if log.action == 'login' %}bg-blue-100 text-blue-600
                                    {% elif log.action == 'register' %}bg-green-100 text-green-600
                                    {% elif log.action == 'create_database' %}bg-green-100 text-green-600
                                    {% elif log.action == 'publish_database' %}bg-purple-100 text-purple-600
                                    {% elif log.action == 'csv_upload' %}bg-orange-100 text-orange-600
                                    {% elif log.action == 'edit_portal_homepage' %}bg-indigo-100 text-indigo-600
                                    {% elif log.action == 'trash_database' %}bg-red-100 text-red-600
                                    {% elif log.action == 'restore_database' %}bg-yellow-100 text-yellow-600
                                    {% else %}bg-gray-100 text-gray-600{% endif %}">
                                    <i class="ri-{% if log.action == 'login' %}login-circle-line
                                        {% elif log.action == 'register' %}user-add-line
                                        {% elif log.action == 'create_database' %}database-line
                                        {% elif log.action == 'publish_database' %}global-line
                                        {% elif log.action == 'csv_upload' %}upload-line
                                        {% elif log.action == 'edit_portal_homepage' %}palette-line
                                        {% elif log.action == 'trash_database' %}delete-bin-line
                                        {% elif log.action == 'restore_database' %}refresh-line
                                        {% else %}activity-line{% endif %} text-sm"></i>
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between">
                                        <h4 class="font-medium text-text">{{ log.action.replace('_', ' ').title() }}</h4>
                                        <span class="text-xs text-textlight">{{ log.timestamp[:16] if log.timestamp else 'N/A' }}</span>
                                    </div>
                                    <p class="text-textlight text-sm mt-1">{{ log.details }}</p>
                                    <div class="text-xs text-textlight mt-2">
                                        User ID: {{ log.user_id[:8] if log.user_id else 'Unknown' }}...
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- User Edit Modal -->
    <div id="edit-user-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg max-w-md w-full p-6">
                <h3 class="text-lg font-semibold mb-4">Edit User Role</h3>
                <form id="edit-user-form" method="post" action="/edit-user-role">
                    <input type="hidden" name="csrftoken" value="{{ csrftoken() }}">
                    <input type="hidden" id="edit-user-id" name="user_id" value="">
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Username</label>
                        <input type="text" id="edit-username" readonly class="w-full p-2 border rounded bg-gray-100">
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Role</label>
                        <select id="edit-role" name="role" class="w-full p-2 border rounded">
                            <option value="system_user">System User</option>
                            <option value="system_admin">System Admin</option>
                        </select>
                    </div>
                    
                    <div class="flex gap-3">
                        <button type="submit" class="bg-accent text-white px-4 py-2 rounded hover:bg-primary transition">
                            Save Changes
                        </button>
                        <button type="button" onclick="closeEditModal()" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400 transition">
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <footer class="bg-gray-50 border-t border-gray-100 py-8">
        <div class="container mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="flex items-center mb-4 md:mb-0">
                    <div class="w-8 h-8 flex items-center justify-center mr-2">
                        <i class="ri-earth-line text-primary ri-lg" aria-hidden="true"></i>
                    </div>
                    <p class="text-primary">
                        Made with <span class="text-red-500" aria-label="love">❤</span> by 
                        <a href="https://envirodatagov.org" rel="nofollow" class="text-accent hover:text-primary">EDGI</a> and 
                        <a href="https://screening-tools.com/" rel="nofollow" class="text-accent hover:text-primary">Public Environmental Data Partners</a>.
                    </p>
                </div>
                <div>
                    <a href="https://opendatacommons.org/licenses/odbl/" class="text-accent hover:text-primary">Data licensed under ODbL</a>
                </div>
            </div>
        </div>
    </footer>

<script>
        function showTab(tabName) {
            // Hide all tab contents
            const contents = document.querySelectorAll('.tab-content');
            contents.forEach(content => content.classList.add('hidden'));
            
            // Remove active class from all tabs
            const tabs = document.querySelectorAll('.tab-button');
            tabs.forEach(tab => {
                tab.classList.remove('active', 'text-accent', 'border-accent');
                tab.classList.add('text-textlight');
            });
            
            // Show selected tab content
            document.getElementById(tabName + '-content').classList.remove('hidden');
                     
            // Add active class to selected tab
            const activeTab = document.getElementById(tabName + '-tab');
            activeTab.classList.add('active', 'text-accent', 'border-accent');
            activeTab.classList.remove('text-textlight');
        }

        function filterUsers() {
            const searchInput = document.getElementById('user-search').value.toLowerCase();
            const roleFilter = document.getElementById('role-filter').value;
            const rows = document.querySelectorAll('.user-row');
            
            rows.forEach(row => {
                const username = row.getAttribute('data-username');
                const email = row.getAttribute('data-email');
                const role = row.getAttribute('data-role');
                
                const matchesSearch = username.includes(searchInput) || email.includes(searchInput);
                const matchesRole = !roleFilter || role === roleFilter;
                
                if (matchesSearch && matchesRole) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function filterDatabases() {
            const filter = document.getElementById('status-filter').value;
            const rows = document.querySelectorAll('.database-row');
            
            rows.forEach(row => {
                if (!filter || row.getAttribute('data-status') === filter) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function filterActivity() {
            const filter = document.getElementById('activity-filter').value;
            const logs = document.querySelectorAll('.activity-log');
            
            logs.forEach(log => {
                if (!filter || log.getAttribute('data-action') === filter) {
                    log.style.display = '';
                } else {
                    log.style.display = 'none';
                }
            });
        }

        function toggleDatabaseDetails(dbId) {
            const detailsRow = document.getElementById(`details-${dbId}`);
            const button = event.target.closest('button');
            const icon = button.querySelector('i');
            
            if (detailsRow.classList.contains('hidden')) {
                detailsRow.classList.remove('hidden');
                icon.className = 'ri-eye-off-line mr-1';
                button.innerHTML = '<i class="ri-eye-off-line mr-1"></i>Hide Details';
                
                // Load database statistics
                loadDatabaseStats(dbId);
            } else {
                detailsRow.classList.add('hidden');
                icon.className = 'ri-eye-line mr-1';
                button.innerHTML = '<i class="ri-eye-line mr-1"></i>View Details';
            }
        }

        function loadDatabaseStats(dbId) {
            const statsDiv = document.getElementById(`stats-${dbId}`);
            if (statsDiv && statsDiv.innerHTML.includes('Loading')) {
                // Simulate loading database stats (you would implement actual API call)
                setTimeout(() => {
                    statsDiv.innerHTML = `
                        <div><strong>Tables:</strong> Loading...</div>
                        <div><strong>Records:</strong> Loading...</div>
                        <div><strong>File Size:</strong> Loading...</div>
                    `;
                }, 500);
            }
        }

        function editUserRole(userId, username, currentRole) {
            document.getElementById('edit-user-id').value = userId;
            document.getElementById('edit-username').value = username;
            document.getElementById('edit-role').value = currentRole;
            document.getElementById('edit-user-modal').classList.remove('hidden');
        }

        function closeEditModal() {
            document.getElementById('edit-user-modal').classList.add('hidden');
        }

        function deleteUser(userId, username) {
            if (confirm(`Are you sure you want to delete user "${username}"? This action cannot be undone.`)) {
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '/delete-user';
                
                const csrfInput = document.createElement('input');
                csrfInput.type = 'hidden';
                csrfInput.name = 'csrftoken';
                csrfInput.value = '{{ csrftoken() }}';
                
                const userIdInput = document.createElement('input');
                userIdInput.type = 'hidden';
                userIdInput.name = 'user_id';
                userIdInput.value = userId;
                
                form.appendChild(csrfInput);
                form.appendChild(userIdInput);
                document.body.appendChild(form);
                form.submit();
            }
        }

        function forceDeleteDatabase(dbName, ownerUsername) {
            // Remove this function since force delete is only available from system trash
            alert('Force delete is only available from the System Trash Bin. Please check the System Trash to force delete databases.');
        }

        // Initialize with databases tab active (changed from users)
        document.addEventListener('DOMContentLoaded', function() {
            showTab('databases');
        });

        // Close modal when clicking outside
        document.getElementById('edit-user-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeEditModal();
            }
        });
    </script>

    <style>
        .tab-button.active {
            border-bottom: 2px solid theme('colors.accent');
        }
        .tab-button:not(.active) {
            border-bottom: 2px solid transparent;
        }
    </style>
</body>
</html>